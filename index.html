<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Vazirmatn', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f9f7f7, #dbe2ef);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      transition: background 0.5s;
    }

    .toggle-theme {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      background: #3f72af;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .toggle-theme:active {
      transform: scale(0.95);
    }

    .upload-box {
      border: 3px dashed #3f72af;
      border-radius: 20px;
      padding: 40px;
      background: #ffffffaa;
      text-align: center;
      transition: all 0.3s ease-in-out;
      cursor: pointer;
      animation: fadeIn 1s ease-in-out;
    }
    .upload-box:hover {
      background: #ffffff;
      box-shadow: 0 0 15px #3f72af88;
    }
    .upload-box input {
      display: none;
    }
    .upload-box label {
      font-size: 1.2rem;
      color: #112d4e;
      cursor: pointer;
    }

    video {
      width: 80vw;
      max-height: 60vh;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
      display: none;
      animation: zoomIn 1s ease-in-out;
    }

    .controls {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      align-items: center;
      width: 80vw;
      max-width: 800px;
      color: #112d4e;
      font-size: 1rem;
      display: none;
    }

    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 4px 8px;
      font-size: 0.8rem;
      border-radius: 5px;
      display: none;
      pointer-events: none;
    }

    #playlist {
      margin-top: 20px;
      list-style: none;
      padding: 0;
      display: none;
    }
    #playlist li {
      padding: 10px;
      background: #f1f1f1;
      margin: 5px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: background 0.3s;
    }
    #playlist li:hover {
      background: #dbe2ef;
    }

    .dark-mode {
      background: #1c1c1c;
    }
    .dark-mode .upload-box {
      background: #333;
      border-color: #aaa;
    }
    .dark-mode .upload-box label,
    .dark-mode .controls,
    .dark-mode #playlist li {
      color: #eee;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ“ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ© / Ø±ÙˆØ´Ù†</button>
  <div class="upload-box" onclick="document.getElementById('videoInput').click()">
    <label for="videoInput">Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆ Ú©Ù„ÛŒÚ© ÛŒØ§ ÙØ§ÛŒÙ„ MP4 Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú©Ø´ÛŒØ¯</label>
    <input type="file" id="videoInput" accept="video/mp4" multiple>
  </div>
  <video id="videoPlayer" controls poster="" preload="metadata">
    <track id="subtitleTrack" label="ÙØ§Ø±Ø³ÛŒ" kind="subtitles" srclang="fa" default>
  </video>
  <div class="controls" id="videoControls">
    <span id="currentTime">00:00</span>
    <span id="duration">/ 00:00</span>
    <input type="file" id="subtitleInput" accept=".vtt">
    <button onclick="shareVideo()">ğŸ“¤ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ</button>
    <button onclick="downloadVideo()">â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆ</button>
    <button onclick="toggleFullScreen()">ğŸ”³ ØªÙ…Ø§Ù… ØµÙØ­Ù‡</button>
  </div>
  <ul id="playlist"></ul>
  <div class="tooltip" id="tooltip"></div>

  <script>
    const videoInput = document.getElementById('videoInput');
    const videoPlayer = document.getElementById('videoPlayer');
    const uploadBox = document.querySelector('.upload-box');
    const controls = document.getElementById('videoControls');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const body = document.body;
    const tooltip = document.getElementById('tooltip');
    const playlist = document.getElementById('playlist');
    const subtitleInput = document.getElementById('subtitleInput');
    const subtitleTrack = document.getElementById('subtitleTrack');

    let videoFiles = [];
    let currentVideoIndex = 0;
    let currentVideoURL = null;

    videoInput.addEventListener('change', function () {
      videoFiles = Array.from(this.files).filter(file => file.type === 'video/mp4');
      if (videoFiles.length > 0) {
        loadVideo(0);
        renderPlaylist();
      }
    });

    function loadVideo(index) {
      const file = videoFiles[index];
      if (file) {
        if (currentVideoURL) URL.revokeObjectURL(currentVideoURL);
        currentVideoURL = URL.createObjectURL(file);
        videoPlayer.src = currentVideoURL;
        videoPlayer.style.display = 'block';
        controls.style.display = 'flex';
        uploadBox.style.display = 'none';
        playlist.style.display = 'block';
        currentVideoIndex = index;
        document.title = `ğŸ¥ Ø¯Ø± Ø­Ø§Ù„ ØªÙ…Ø§Ø´Ø§ÛŒ: ${file.name}`;
      }
    }

    function renderPlaylist() {
      playlist.innerHTML = '';
      videoFiles.forEach((file, index) => {
        const li = document.createElement('li');
        li.textContent = file.name;
        li.onclick = () => loadVideo(index);
        playlist.appendChild(li);
      });
    }

    videoPlayer.addEventListener('loadedmetadata', () => {
      durationEl.textContent = '/ ' + formatTime(videoPlayer.duration);
      const savedTime = localStorage.getItem('videoTime');
      if (savedTime) videoPlayer.currentTime = parseFloat(savedTime);
    });

    videoPlayer.addEventListener('timeupdate', () => {
      currentTimeEl.textContent = formatTime(videoPlayer.currentTime);
      localStorage.setItem('videoTime', videoPlayer.currentTime);
    });

    videoPlayer.addEventListener('ended', () => {
      if (currentVideoIndex + 1 < videoFiles.length) loadVideo(currentVideoIndex + 1);
    });

    function formatTime(time) {
      const minutes = Math.floor(time / 60);
      const seconds = Math.floor(time % 60);
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function toggleTheme() {
      body.classList.toggle('dark-mode');
    }

    videoPlayer.addEventListener('mousemove', (e) => {
      const rect = videoPlayer.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      const previewTime = percent * videoPlayer.duration;
      tooltip.textContent = formatTime(previewTime);
      tooltip.style.left = e.clientX + 'px';
      tooltip.style.top = (rect.top - 30) + 'px';
      tooltip.style.display = 'block';
    });

    videoPlayer.addEventListener('mouseleave', () => {
      tooltip.style.display = 'none';
    });

    subtitleInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        subtitleTrack.src = url;
      }
    });

    function shareVideo() {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(window.location.href);
        alert('Ù„ÛŒÙ†Ú© ØµÙØ­Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯!');
      }
    }

    function downloadVideo() {
      const a = document.createElement('a');
      a.href = videoPlayer.src;
      a.download = `video_${Date.now()}.mp4`;
      a.click();
    }

    function toggleFullScreen() {
      if (!document.fullscreenElement) {
        videoPlayer.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }
  </script>
</body>
</html>
